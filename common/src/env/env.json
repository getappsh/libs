  {
    "$schema": "./env.schema.json",
    "title": "Get-App, Environment documentation",
    "id": "get-app",
    "description": "Environment variables documentation for get-app microservice.",
    "version": "1.0.0",
    "scopes": [
      {
        "title": "General Configuration",
        "id": "general",
        "description": "General environment variables used for all microservices",
        "variables": [
          {
            "name": "REGION",
            "description": "Defines the region used for Kafka topics and database names. ",
            "warning": [
              "If implemented, it must be consistent across all microservices."
            ],
            "required": false,
            "type": "string"
          },
          {
            "name": "SERVER_NAME",
            "description": "Name of the server instance.",
            "warning": [
              "Should be unique within the deployment environment."
            ],
            "required": false,
            "type": "string"
          },
          {
            "name": "DEPLOY_ENV",
            "description": "Deployment environment identifier. Typical values: CTS or TNG.",
            "required": false,
            "type": "enum",
            "enum": [
              "CTS",
              "TNG"
            ],
            "hidden": true
          },
          {
            "name": "LOGGER_FORMAT",
            "description": "Format of the logs output by the microservice. Can be JSON or STRING.",
            "required": false,
            "type": "enum",
            "enum": [
              "JSON",
              "STRING"
            ],
            "default": "STRING",
            "subTitle": "Logger"
          },
          {
            "name": "LOG_LEVEL",
            "description": "Defines the logging level. For JSON logger: [\"fatal\", \"error\", \"warn\", \"info\", \"debug\", \"trace\"]. For STRING logger: [\"log\", \"error\", \"warn\", \"debug\", \"verbose\"].",
            "required": true,
            "type": "enum",
            "enum": [
              "fatal",
              "error",
              "warn",
              "info",
              "debug",
              "trace",
              "log",
              "verbose"
            ],
            "default": " \"trace\" or \"verbose\"",
            "subTitle": "Logger"
          }
        ]
      },
      {
        "title": "PostgreSQL Database Configuration",
        "id": "postgres-config",
        "description": "Environment variables for configuring PostgreSQL connection and migrations",
        "variables": [
          {
            "name": "POSTGRES_HOST",
            "subTitle": "Basic config",
            "description": "Hostname or IP address of the PostgreSQL server",
            "required": true,
            "type": "string"
          },
          {
            "name": "POSTGRES_PORT",
            "subTitle": "Basic config",
            "description": "Port number on which PostgreSQL is listening",
            "required": true,
            "type": "number",
            "example": 5432
          },
          {
            "name": "POSTGRES_DB",
            "subTitle": "Basic config",
            "description": "Database name to connect to",
            "required": true,
            "type": "string",
            "example": "getapp_db"
          },
          {
            "name": "POSTGRES_USER",
            "subTitle": "Basic config",
            "description": "Username for PostgreSQL authentication",
            "required": true,
            "type": "string",
            "example": "postgres"
          },
          {
            "name": "POSTGRES_PASSWORD",
            "subTitle": "Auth config",
            "description": "Password for PostgreSQL authentication",
            "required": {
              "if": {
                "POSTGRES_SSL": "false"
              }
            },
            "type": "string"
          },
          {
            "name": "POSTGRES_SSL",
            "subTitle": "Auth config",
            "description": "Flag if connection to PostgreSQL is by SSL.",
            "required": false,
            "type": "boolean",
            "default": false,
            "warning": [
              "It will be implemented in the future, for now needs to define the 'DEPLOY_ENV' variable"
            ]
          },
          {
            "name": "DB_PEM_PATH",
            "subTitle": "Auth config",
            "description": "File system path to the CA certificate PEM file for SSL connection to PostgreSQL.",
            "required": {
              "if": {
                "POSTGRES_SSL": "true"
              }
            },
            "type": "string",
            "example": "/path/to/ca.pem"
          },
          {
            "name": "DB_CERT_PATH",
            "subTitle": "Auth config",
            "description": "File system path to the client certificate PEM file for SSL connection to PostgreSQL.",
            "required": {
              "if": {
                "POSTGRES_SSL": "true"
              }
            },
            "type": "string",
            "example": "/path/to/cert.pem"
          },
          {
            "name": "DB_KEY_PATH",
            "subTitle": "Auth config",
            "description": "File system path to the private key PEM file for SSL connection to PostgreSQL.",
            "required": {
              "if": {
                "POSTGRES_SSL": "true"
              }
            },
            "type": "string",
            "example": "/path/to/key.pem"
          },
          {
            "name": "MIGRATION_RUN",
            "description": "Flag to determine if database migrations should be run",
            "required": false,
            "type": "boolean",
            "default": true
          }
        ]
      },
      {
        "title": "Api microservice",
        "description": "Environment variables for api microservice.",
        "variables": [
          {
            "name": "SERVER_PORT",
            "subTitle": "General config",
            "description": "The port on which the API server will run",
            "type": "number",
            "default": 3000,
            "required": false
          },
          {
            "name": "HTTP_PROTOCOL",
            "subTitle": "TLS config",
            "description": "Defines if the server run in secure mode with http protocol (true for secure), used for communication with out a wrapper like nginx, kube ingress, etc.",
            "required": false,
            "type": "boolean",
            "default": false
          },
          {
            "name": "CA_CERT_PATH",
            "subTitle": "TLS config",
            "description": "Path to the CA certificate file used to authenticate clients.",
            "required": {
              "if": {
                "HTTP_PROTOCOL": "true"
              }
            },
            "type": "string",
            "example": "./certs/ca.crt"
          },
          {
            "name": "SERVER_CERT_PATH",
            "subTitle": "TLS config",
            "description": "Path to the certificate file for HTTPS server.",
            "required": {
              "if": {
                "HTTP_PROTOCOL": "true"
              }
            },
            "type": "string",
            "example": "./certs/server.crt"
          },
          {
            "name": "SERVER_KEY_PATH",
            "subTitle": "TLS config",
            "description": "Path to the private key file for HTTPS server.",
            "required": {
              "if": {
                "HTTP_PROTOCOL": "true"
              }
            },
            "type": "string",
            "example": "./certs/server.key"
          }
        ]
      },
      {
        "title": "Authentication service",
        "description": "Authentication environment variables",
        "variables": [
          {
            "name": "AUTH_SERVER_URL",
            "description": "URL of the Keycloak authentication server",
            "required": true,
            "type": "string",
            "format": "uri",
            "subTitle": "SSO Auth"
          },
          {
            "name": "REALM",
            "description": "Realm used in Keycloak",
            "required": true,
            "type": "string",
            "subTitle": "SSO Auth"
          },
          {
            "name": "CLIENT_ID",
            "description": "Client ID registered in Keycloak",
            "required": true,
            "type": "string",
            "subTitle": "SSO Auth"
          },
          {
            "name": "SECRET_KEY",
            "description": "Secret key for Keycloak client",
            "required": true,
            "type": "string",
            "subTitle": "SSO Auth"
          },
          {
            "name": "COOKIE_KEY",
            "description": "Key used to sign and encrypt cookies",
            "required": true,
            "type": "string",
            "subTitle": "SSO Auth"
          },
          {
            "name": "DEVICE_AUTH",
            "description": "A secret key to check against the value in the Device-Auth header",
            "required": false,
            "type": "string",
            "subTitle": "Secret Auth"
          },
          {
            "name": "DEVICE_SECRET",
            "description": "A secret key to check against the value in the Device-Auth header",
            "required": false,
            "type": "string",
            "subTitle": "Secret Auth",
            "deprecated": true,
            "deprecationNote": "Use DEVICE_AUTH instead"
          }
        ]
      },
      {
        "title": "Proxy Mode",
        "id": "proxy-mode",
        "description": "Environment variables that configure the application to operate in proxy mode.",
        "variables": [
          {
            "name": "IS_PROXY",
            "subTitle": "General config",
            "description": "Flag to determine if the application runs as a proxy",
            "type": "boolean",
            "required": false
          },
          {
            "name": "GETAPP_URL",
            "subTitle": "General config",
            "description": "Defines the URL of the main API server (not the proxy)",
            "type": "string",
            "required": {
              "if": {
                "IS_PROXY": "true"
              }
            },
            "format": "uri"
          },
          {
            "name": "ANALYTICS_SERVER_URL",
            "subTitle": "General config",
            "description": "Defines the URL of the analytics server",
            "type": "string",
            "required": {
              "if": {
                "IS_PROXY": "true"
              }
            },
            "format": "uri"
          },
          {
            "name": "GETAPP_USERNAME",
            "subTitle": "API Auth",
            "description": "Username used to authenticate with the main API server",
            "type": "string",
            "required": {
              "if": {
                "IS_PROXY": "true",
                "DEVICE_SECRET": "",
                "DIST_HTTP_PROTOCOL": "false"
              }
            }
          },
          {
            "name": "GETAPP_PASSWORD",
            "subTitle": "API Auth",
            "description": "Password used to authenticate with the main API server",
            "type": "string",
            "required": {
              "if": {
                "IS_PROXY": "true",
                "DEVICE_SECRET": "",
                "DIST_HTTP_PROTOCOL": "false"
              }
            }
          },
          {
            "name": "DEVICE_SECRET",
            "subTitle": "API Auth",
            "description": "A secret key that will be added to each request in the Device-Auth header",
            "type": "string",
            "required": {
              "if": {
                "IS_PROXY": "true",
                "GETAPP_USERNAME": "",
                "GETAPP_PASSWORD": ""
              }
            }
          },
          {
            "name": "PROXY_SECURE_TLS",
            "subTitle": "TLS Verification",
            "description": "Determines whether the proxy validates the main server's TLS certificate",
            "type": "boolean",
            "required": false,
            "default": true,
            "notes": [
              "Set to false to skip certificate validation (use with caution)."
            ]
          },
          {
            "name": "GETAPP_URL",
            "subTitle": "TLS 'with out' client certificates",
            "description": "The URL of the main API server",
            "required": {
              "if": {
                "DIST_HTTP_PROTOCOL": "false"
              }
            },
            "type": "string",
            "format": "uri"
          },
          {
            "name": "NODE_EXTRA_CA_CERTS",
            "subTitle": "TLS 'with out' client certificates",
            "description": "Path to additional CA certificates used for verifying HTTPS requests in non-secure mode",
            "required": {
              "if": {
                "DIST_HTTP_PROTOCOL": "false",
                "GETAPP_URL": "starts with http**<span style=\"font-weight:bold\">s</span>**"
              }
            },
            "type": "string"
          },
          {
            "name": "DIST_HTTP_PROTOCOL",
            "subTitle": "TLS with client certificates",
            "description": "Defines if the destination service runs in secure mode with http protocol (true for secure), used for communication the main API server with client certificates",
            "required": false,
            "type": "boolean",
            "default": false
          },
          {
            "name": "CA_CERT_PATH",
            "subTitle": "TLS with client certificates",
            "description": "Filesystem path to the CA certificate used to validate server",
            "required": {
              "if": {
                "DIST_HTTP_PROTOCOL": "true"
              }
            },
            "type": "string",
            "example": "/etc/ssl/certs/ca.crt"
          },
          {
            "name": "CLIENT_CERT_PATH",
            "subTitle": "TLS with client certificates",
            "description": "Filesystem path to the client TLS certificate",
            "required": {
              "if": {
                "DIST_HTTP_PROTOCOL": "true"
              }
            },
            "type": "string",
            "example": "/etc/ssl/certs/client.crt"
          },
          {
            "name": "CLIENT_KEY_PATH",
            "subTitle": "TLS with client certificates",
            "description": "Filesystem path to the client TLS key file used in mTLS",
            "required": {
              "if": {
                "DIST_HTTP_PROTOCOL": "true"
              }
            },
            "type": "string",
            "example": "/etc/ssl/private/client.key"
          },
          {
            "name": "GETAPP_SSL_URL",
            "subTitle": "TLS with client certificates",
            "description": "Target hostname the main API server to establish a secure connection with client certificates",
            "required": {
              "if": {
                "DIST_HTTP_PROTOCOL": "true"
              }
            },
            "type": "string",
            "notes": [
              "The URL of the destination server should be a hostname only, without protocol. Example: 'google.com', not 'https://google.com'."
            ],
            "example": "google.com",
            "format": "hostname"
          },
          {
            "name": "GETAPP_SSL_PORT",
            "subTitle": "TLS with client certificates",
            "description": "Port of the main API server to establish a secure connection with client certificates",
            "required": {
              "if": {
                "DIST_HTTP_PROTOCOL": "true"
              }
            },
            "type": "number",
            "notes": [
              "Needs to be set only in api microservice."
            ]
          }
        ]
      },
      {
        "title": "Cache Service",
        "id": "cache-service",
        "description": "Configuration for using the delivery service as a cache layer",
        "variables": [
          {
            "name": "USE_CACHE",
            "subTitle": "Cache Configuration",
            "description": "Flag to determine whether to use the delivery service as a cache layer",
            "type": "boolean",
            "required": false,
            "notes": [
              "Requires AWS environment variables to be configured when enabled",
              "If var IS_PROXY of proxy service is set to true, cache service will be in use even if this variable is set to false"
            ]
          },
          {
            "name": "CACHE_CLEAR_TIME_EXPRESSION",
            "subTitle": "Cache Configuration",
            "description": "Specifies the cron schedule for clearing the cache",
            "type": "string",
            "required": false,
            "default": "0 0 * * *",
            "format": "cron"
          },
          {
            "name": "CACHE_EXPIRATION_HOURS",
            "subTitle": "Cache Configuration",
            "description": "Sets the duration (in hours) for how long cached items remain valid before expiration",
            "type": "number",
            "required": false,
            "default": "7 days"
          },
          {
            "name": "CACHE_SYNC_TIME_EXPRESSION",
            "subTitle": "Cache Configuration",
            "description": "Specifies the cron schedule for syncing the cache data between the DB and S3",
            "type": "string",
            "required": false,
            "default": "0 01 * * *",
            "format": "cron"
          },
          {
            "name": "HARBOR_CACHE_REGISTRY_URL",
            "subTitle": "Harbor Registry Cache",
            "description": "Harbor registry project that acts as a cache to the main Docker registry",
            "type": "string",
            "required": {
              "oneOf": [
                {
                  "USE_CACHE": "true"
                },
                {
                  "IS_PROXY": "true"
                }
              ]
            },
            "format": "uri",
            "notes": [
              "This variable is required if the cache service cached docker images."
            ]
          }
        ]
      },
      {
        "title": "JWT Configuration",
        "description": "JWT Configuration, to generate jwt token",
        "variables": [
          {
            "name": "JWT_SECRET",
            "description": "A secret string for the jwt token",
            "required": true,
            "type": "string"
          },
          {
            "name": "JWT_EXPIRATION",
            "description": "expressed in seconds or a string describing a time span [zeit/ms](https://github.com/zeit/ms.js).  Eg: 60, '2 days', '10h', '7d'",
            "required": true,
            "type": "string"
          }
        ]
      },
      {
        "title": "Get-map microservice",
        "description": "Environment variables for get-map microservice.",
        "variables": [
          {
            "name": "LIBOT_DISCOVERY_URL",
            "description": "The url of the libot discovery service",
            "type": "string",
            "format": "uri",
            "required": true,
            "subTitle": "libot"
          },
          {
            "name": "LIBOT_EXPORT_URL",
            "description": "The url of the libot export service",
            "type": "string",
            "format": "uri",
            "required": true,
            "subTitle": "libot"
          },
          {
            "name": "LIBOT_CALLBACK_URL",
            "description": "The url provided to libot to call back to the service",
            "type": "string",
            "format": "uri",
            "required": true,
            "subTitle": "libot"
          },
          {
            "name": "TOKEN_LIBOT",
            "description": "The token to authenticate with libot",
            "type": "string",
            "required": true,
            "subTitle": "libot"
          },
          {
            "name": "PROXY_DOWNLOAD_BASE_URL",
            "description": "When using proxy server for vpn connection, this prefix will change the original prefix",
            "type": "string",
            "format": "uri",
            "required": false
          },
          {
            "name": "MC_CSW_REF_DATE",
            "description": "The reference date for the filter products",
            "type": "string",
            "format": "date-time",
            "default": "2023-10-15T00:00:01Z",
            "required": false,
            "subTitle": "products filtering params"
          },
          {
            "name": "TARGET_RESOLUTION",
            "description": "The target resolution for filtering products",
            "type": "number",
            "default": 17,
            "required": false,
            "subTitle": "products filtering params"
          },
          {
            "name": "MC_MIN_RESOLUTION_DEG",
            "description": "The minimum resolution for exporting maps",
            "type": "number",
            "default": 4.29153E-05,
            "required": true,
            "subTitle": "products filtering params"
          },
          {
            "name": "MC_MAX_RESOLUTION_DEG",
            "description": "The maximum resolution for exporting maps",
            "type": "number",
            "default": 1.34110E-06,
            "required": true,
            "subTitle": "products filtering params"
          },
          {
            "name": "PRODUCTS_CREATION_METHOD",
            "description": "set the method to create products",
            "type": "enum",
            "enum": [
              "single",
              "polygonParts"
            ],
            "default": "single",
            "required": false,
            "subTitle": "WFS supporting"
          },
          {
            "name": "POLYGON_PARTS_WFS",
            "description": "The url of the polygon parts wfs service. Required if using the 'polygonParts' method in PRODUCTS_CREATION_METHOD.",
            "type": "string",
            "format": "uri",
            "required": {
              "if": {
                "PRODUCTS_CREATION_METHOD": "polygonParts"
              },
              "then": true
            },
            "subTitle": "WFS supporting"
          },
          {
            "name": "MANEUVER_AREA",
            "description": "The maneuver area for the polygon parts method, in the format of 'lat,lon,lat,lon,...'. Required if using the 'polygonParts' method in PRODUCTS_CREATION_METHOD.",
            "type": "string",
            "pattern": "^(-?\\d+(?:\\.\\d+)?),(-?\\d+(?:\\.\\d+)?)(,(-?\\d+(?:\\.\\d+)?),(-?\\d+(?:\\.\\d+)?))*$",
            "example": "32.1,34.8,32.2,34.9,32.3,35.0",
            "required": {
              "if": {
                "PRODUCTS_CREATION_METHOD": "polygonParts"
              },
              "then": true
            },
            "subTitle": "WFS supporting"
          },
          {
            "name": "SEQUENTIAL_PRODUCT_ID",
            "description": "The sequential product id for the polygon parts method, in format of 'productId-productType'. Required if using the 'polygonParts' method in PRODUCTS_CREATION_METHOD.",
            "type": "string",
            "pattern": "^[a-zA-Z0-9]+-[a-zA-Z0-9]+$",
            "example": "12345-ortho",
            "required": {
              "if": {
                "PRODUCTS_CREATION_METHOD": "polygonParts"
              },
              "then": true
            },
            "subTitle": "WFS supporting"
          },
          {
            "name": "UPDATE_GOB_TIME",
            "description": "The cron time to update the GOB, default is every 6 hours",
            "type": "string",
            "default": "0 0 */6 * * *",
            "pattern": "^([0-5]?\\d)\\s([0-5]?\\d)\\s([0-2]?\\d|\\*)\\s([1-9]|1[0-2]|\\*)\\s([0-6]|\\*)\\s([0-7]|\\*)$",
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "PRODUCTS_STALE_AFTER",
            "description": "The time in minutes to consider a product stale, default is 3 minute",
            "type": "number",
            "default": 3,
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "USE_PRODUCTS_CACHE",
            "description": "A flag if using cache for products, default is true",
            "type": "boolean",
            "default": true,
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "PERIODIC_GET_MAP_STATUS",
            "description": "Seconds to set the periodic time to request status for map â€” default is 3 seconds",
            "type": "number",
            "default": 3,
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "MAP_RETRY_EXPONENTIAL_TIMES",
            "description": "The exponential times for retrying the request in array, default is [0.3, 5, 15]",
            "type": "string",
            "default": "[0.3, 5, 15]",
            "pattern": "^\\[\\s*(\\d+(\\.\\d+)?)(\\s*,\\s*\\d+(\\.\\d+)?)*\\s*\\]$",
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "MAP_RETRY_WAIT_TIME",
            "description": "The time to wait between retries, default is 0.3",
            "type": "number",
            "default": 0.3,
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "MAP_RETRY_COUNT",
            "description": "The number of retries, default is 3",
            "type": "number",
            "default": 3,
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "UPDATE_JOB_MAP_TAKE",
            "description": "The number of maps to take in each update job, default is 25",
            "type": "number",
            "default": 25,
            "required": false,
            "subTitle": "service configs"
          },
          {
            "name": "LIBOT_EMULATOR",
            "description": "set if use an emulator to emulate libot",
            "type": "boolean",
            "default": false,
            "required": false,
            "subTitle": "libot emulator"
          }
        ]
      },
      {
        "title": "Libot emulator microservice",
        "description": "Environment variables for libot emulator microservice.",
        "variables": [
          {
            "name": "LIBOT_SERVER_ADDRESS",
            "description": "The address of the libot server",
            "type": "string",
            "format": "uri",
            "required": true
          }
        ]
      }
    ]
  }